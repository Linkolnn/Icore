# üéØ –î–µ–Ω—å 2: Backend - User Search API

> API –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–∞–∫ –≤ Telegram)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–ï–¢ –°–ò–°–¢–ï–ú–´ –î–†–£–ó–ï–ô!

**iCore Messenger —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ Telegram:**
- ‚ùå –ù–ï–¢ Friend Request schema
- ‚ùå –ù–ï–¢ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è
- ‚ùå –ù–ï–¢ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –ª—é–±–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—É—á–µ–Ω–∏—è

### 1Ô∏è‚É£ [Theory.md](./Theory.md) - –¢–µ–æ—Ä–∏—è
–ò–∑—É—á–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∞–∫—Ç–∏–∫–æ–π:
- MongoDB Query Builder ($regex, $or, $ne)
- MongoDB Text Indexes
- Pagination (offset-based)
- DTO Validation (query parameters)
- Service Layer Pattern
- Error Handling

**–í—Ä–µ–º—è:** ~1-2 —á–∞—Å–∞

---

### 2Ô∏è‚É£ [Practice.md](./Practice.md) - –ü—Ä–∞–∫—Ç–∏–∫–∞
–ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- SearchUsersDto (DTO –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- searchUsers() –º–µ—Ç–æ–¥ –≤ UsersService
- GET /users/search endpoint –≤ UsersController
- MongoDB text indexes –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞

---

### 3Ô∏è‚É£ [Checklist.md](./Checklist.md) - –ß–µ–∫-–ª–∏—Å—Ç
–û—Ç—Å–ª–µ–∂–∏–≤–∞–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤—Å–µ–º —ç—Ç–∞–ø–∞–º

---

## üéØ –¶–µ–ª—å –¥–Ω—è

–°–æ–∑–¥–∞—Ç—å User Search API —Å:
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ name, userId, email
- ‚úÖ Pagination (limit, skip, total, hasMore)
- ‚úÖ MongoDB text indexes –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ DTO –≤–∞–ª–∏–¥–∞—Ü–∏—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)

---

## üì¶ –ß—Ç–æ –ø–æ–ª—É—á–∏—à—å

### API Endpoint:

```
GET /users/search?query=john&limit=10&skip=0
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (string, –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `limit` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: 10) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `skip` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: 0) - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å N —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û—Ç–≤–µ—Ç:**
```json
{
  "users": [
    {
      "_id": "507f1f77bcf86cd799439011",
      "userId": "john1234",
      "name": "John Doe",
      "email": "john@example.com",
      "avatar": "https://...",
      "createdAt": "2024-01-15T10:30:00Z"
    }
  ],
  "total": 42,
  "hasMore": true
}
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **NestJS** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **MongoDB** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Mongoose** - ODM
- **TypeScript** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **class-validator** - –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ü—Ä–æ—á–∏—Ç–∞–π [Theory.md](./Theory.md)
2. –°–ª–µ–¥—É–π [Practice.md](./Practice.md)
3. –û—Ç–º–µ—á–∞–π [Checklist.md](./Checklist.md)

---

## üéì –ß—Ç–æ –∏–∑—É—á–∏—à—å

### MongoDB Concepts
- **Query Builder** - $regex, $or, $ne –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- **Text Indexes** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **Pagination** - offset-based (skip, limit)
- **Query Optimization** - lean(), select()

### NestJS Patterns
- **DTO Pattern** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **Service Layer** - –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- **Error Handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–∏—Å–∫–∞
- **Guards** - –∑–∞—â–∏—Ç–∞ endpoint —á–µ—Ä–µ–∑ JwtAuthGuard

---

## ‚è±Ô∏è –í—Ä–µ–º—è

| –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|-----------|-------|
| –¢–µ–æ—Ä–∏—è | 1-2 —á |
| –ü—Ä–∞–∫—Ç–∏–∫–∞ | 2-3 —á |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω |
| **–ò—Ç–æ–≥–æ** | **~4-5 —á** |

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–°–Ω–∞—á–∞–ª–∞ —Ç–µ–æ—Ä–∏—è, –ø–æ—Ç–æ–º –ø—Ä–∞–∫—Ç–∏–∫–∞** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
2. **–¢–µ—Å—Ç–∏—Ä—É–π endpoint —Å—Ä–∞–∑—É** - –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ curl –∏–ª–∏ Postman
3. **–ü—Ä–æ–≤–µ—Ä—è–π indexes –≤ MongoDB Compass** - —É–±–µ–¥–∏—Å—å —á—Ç–æ text indexes —Å–æ–∑–¥–∞–Ω—ã
4. **–ò—Å–ø–æ–ª—å–∑—É–π MongoDB lean()** - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç plain objects)
5. **–ò—Å–∫–ª—é—á–∞–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - `.select('-password -refreshToken')`

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "Cannot find users"
**–ü—Ä–∏—á–∏–Ω–∞:** Text indexes –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å `UserSchema.index({ name: 'text', userId: 'text', email: 'text' })`

### "Query too short"
**–ü—Ä–∏—á–∏–Ω–∞:** DTO –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞
**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤—å –∑–∞–ø—Ä–æ—Å —Å `query` –¥–ª–∏–Ω–æ–π ‚â•2 —Å–∏–º–≤–æ–ª–æ–≤

### "CORS error"
**–ü—Ä–∏—á–∏–Ω–∞:** Frontend –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ Backend
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å `enableCors()` –≤ `backend/src/main.ts`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ curl
```bash
# –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
curl "http://localhost:4000/api/users/search?query=john&limit=5" \
  -H "Authorization: Bearer YOUR_TOKEN"

# –° pagination
curl "http://localhost:4000/api/users/search?query=test&limit=10&skip=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### –ß–µ—Ä–µ–∑ Postman
1. –°–æ–∑–¥–∞–π GET –∑–∞–ø—Ä–æ—Å –Ω–∞ `http://localhost:4000/api/users/search`
2. –î–æ–±–∞–≤—å Query Params: `query`, `limit`, `skip`
3. –î–æ–±–∞–≤—å Header: `Authorization: Bearer YOUR_TOKEN`
4. Send!

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

Backend —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º –∫–æ–≥–¥–∞:

### –ö–æ–¥ ‚úì
- [ ] SearchUsersDto —Å–æ–∑–¥–∞–Ω —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] UsersService.searchUsers() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] UsersController GET /users/search —Å–æ–∑–¥–∞–Ω
- [ ] MongoDB text indexes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úì
- [ ] GET /users/search –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] –ü–æ–∏—Å–∫ –ø–æ name —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–∏—Å–∫ –ø–æ userId —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–∏—Å–∫ –ø–æ email —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Pagination —Ä–∞–±–æ—Ç–∞–µ—Ç (limit, skip)
- [ ] total –∏ hasMore –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] DTO –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úì
- [ ] Checklist.md –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç PATTERNS_CHECKLIST.md

---

## üîó –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏

### –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç—å:
- **–î–µ–Ω—å 1: Backend** - User schema, Auth API, JWT Guards

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
- **–î–µ–Ω—å 2: Frontend** - Sidebar UI, AppHeader, SearchInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–î–µ–Ω—å 3: –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Ç–æ–≤
- **–î–µ–Ω—å 4: –û–∫–Ω–æ —á–∞—Ç–∞** - —Å–æ–æ–±—â–µ–Ω–∏—è

---

**–£–¥–∞—á–∏! üöÄ**
