# ๐๏ธ Backend Auth - ะะฑะทะพั ะฐััะธัะตะบัััั

## ะงัะพ ะฑัะปะพ ัะพะทะดะฐะฝะพ

Backend ัะธััะตะผะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ **ะปัััะธั ะฟัะฐะบัะธะบ** ะธ **Design Patterns**.

---

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
backend/src/modules/
โโโ users/
โ   โโโ schemas/
โ       โโโ user.schema.ts          โ Mongoose ััะตะผะฐ (ะผะพะดะตะปั User ะฒ MongoDB)
โโโ auth/
    โโโ dto/
    โ   โโโ register.dto.ts         โ DTO ะดะปั ัะตะณะธัััะฐัะธะธ (ะฒะฐะปะธะดะฐัะธั)
    โ   โโโ login.dto.ts            โ DTO ะดะปั ะฒัะพะดะฐ (ะฒะฐะปะธะดะฐัะธั)
    โโโ strategies/
    โ   โโโ jwt.strategy.ts         โ ะกััะฐัะตะณะธั ะฟัะพะฒะตัะบะธ JWT ัะพะบะตะฝะพะฒ
    โโโ guards/
    โ   โโโ jwt-auth.guard.ts       โ Guard ะดะปั ะทะฐัะธัั routes
    โโโ auth.service.ts             โ ะะธะทะฝะตั-ะปะพะณะธะบะฐ (bcrypt, JWT)
    โโโ auth.controller.ts          โ HTTP endpoints (API)
    โโโ auth.module.ts              โ ะะพะดัะปั (ัะฒัะทัะฒะฐะตั ะฒัั ะฒะผะตััะต)
```

---

## ๐ฏ ะััะธัะตะบัััะฝัะต ะฟะฐััะตัะฝั

### 1. **Layered Architecture** (ะกะปะพัะฝะฐั ะฐััะธัะตะบัััะฐ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Controller Layer              โ  โ HTTP ะทะฐะฟัะพัั/ะพัะฒะตัั
โ   (auth.controller.ts)          โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโ
             โ ะฒัะทัะฒะฐะตั
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโ
โ   Service Layer                 โ  โ ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   (auth.service.ts)             โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโ
             โ ะธัะฟะพะปัะทัะตั
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโ
โ   Data Layer                    โ  โ ะะฐะฑะพัะฐ ั ะะ
โ   (user.schema.ts + Mongoose)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐัะตะผ**:
- โ ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ (ะบะฐะถะดัะน ัะปะพะน ัะฒะพั ะทะฐะดะฐัะฐ)
- โ ะะตะณะบะพ ัะตััะธัะพะฒะฐัั (ะผะพะถะฝะพ ะผะพะบะธัะพะฒะฐัั ัะปะพะธ)
- โ ะะตะณะบะพ ะธะทะผะตะฝััั (ะทะฐะผะตะฝะฐ ะะ ะฝะต ะทะฐััะพะฝะตั ะบะพะฝััะพะปะปะตั)

---

### 2. **Dependency Injection (DI)** - ะะฝะตะดัะตะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน

```typescript
// AuthService ะะ ัะพะทะดะฐัั ะทะฐะฒะธัะธะผะพััะธ, ะฐ ะฟะพะปััะฐะตั ะธั:
@Injectable()
export class AuthService {
  constructor(
    @InjectModel(User.name) private userModel: Model<User>,  // โ ะะฝะตะดัะตะฝะพ
    private jwtService: JwtService,                          // โ ะะฝะตะดัะตะฝะพ
  ) {}
}
```

**ะะฐัะตะผ**:
- โ ะกะปะฐะฑะฐั ัะฒัะทะฐะฝะฝะพััั (loose coupling)
- โ ะะตะณะบะพ ัะตััะธัะพะฒะฐัั (ะผะพะถะฝะพ ะฟะพะดะผะตะฝะธัั ะทะฐะฒะธัะธะผะพััะธ)
- โ ะะตัะตะธัะฟะพะปัะทัะตะผะพััั (ะพะดะธะฝ ัะตัะฒะธั ะธัะฟะพะปัะทัะตััั ะฒะตะทะดะต)

---

### 3. **DTO Pattern** - Data Transfer Object

```typescript
// DTO ะพะฟัะตะดะตะปัะตั ััััะบัััั ะดะฐะฝะฝัั + ะฒะฐะปะธะดะฐัะธั:
export class RegisterDto {
  @IsNotEmpty()
  @IsString()
  name: string

  @IsEmail()
  email: string

  @MinLength(6)
  password: string
}
```

**ะะฐัะตะผ**:
- โ ะะฐะปะธะดะฐัะธั ะฝะฐ ะฒัะพะดะต (ะทะฐัะธัะฐ ะพั ะฝะตะฒะฐะปะธะดะฝัั ะดะฐะฝะฝัั)
- โ ะะฒัะพะดะพะบัะผะตะฝัะฐัะธั API (ะฒะธะดะฝะพ ััะพ ะฟัะธะฝะธะผะฐะตั endpoint)
- โ ะขะธะฟะพะฑะตะทะพะฟะฐัะฝะพััั (TypeScript ะฟัะพะฒะตััะตั ัะธะฟั)

---

### 4. **Strategy Pattern** - ะะฐััะตัะฝ ัััะฐัะตะณะธั

```typescript
// JwtStrategy - ะพะดะฝะฐ ะธะท ัััะฐัะตะณะธะน ะฐััะตะฝัะธัะธะบะฐัะธะธ:
export class JwtStrategy extends PassportStrategy(Strategy) {
  async validate(payload: any) {
    // ะะพะณะธะบะฐ ะฟัะพะฒะตัะบะธ ัะพะบะตะฝะฐ
    return user
  }
}
```

**ะะฐัะตะผ**:
- โ ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะดััะณะธะต ัััะฐัะตะณะธะธ (OAuth, Local, etc.)
- โ ะะทะพะปะธัะพะฒะฐะฝะฝะฐั ะปะพะณะธะบะฐ (ะบะฐะถะดะฐั ัััะฐัะตะณะธั ะฝะตะทะฐะฒะธัะธะผะฐ)
- โ ะะตะณะบะพ ะฟะตัะตะบะปััะฐัััั ะผะตะถะดั ัััะฐัะตะณะธัะผะธ

---

### 5. **Guard Pattern** - ะะฐััะตัะฝ ะทะฐัะธัั

```typescript
// JwtAuthGuard ะทะฐัะธัะฐะตั routes:
@Get('profile')
@UseGuards(JwtAuthGuard)  // โ ะขัะตะฑัะตั ะฐะฒัะพัะธะทะฐัะธั
getProfile(@Request() req) {
  return req.user
}
```

**ะะฐัะตะผ**:
- โ ะะตะบะปะฐัะฐัะธะฒะฝะฐั ะทะฐัะธัะฐ (ะฒะธะดะฝะพ ััะฐะทั ััะพ ััะตะฑัะตั ะฐะฒัะพัะธะทะฐัะธั)
- โ ะะตัะตะธัะฟะพะปัะทัะตะผะพััั (ะพะดะธะฝ Guard ะดะปั ะฒัะตั routes)
- โ ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ (Guard ะฟัะพะฒะตััะตั, Controller ะพะฑัะฐะฑะฐััะฒะฐะตั)

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### 1. **Bcrypt** - ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน

```typescript
// ะฅะตัะธัะพะฒะฐะฝะธะต ะฟัะธ ัะตะณะธัััะฐัะธะธ:
const hashedPassword = await bcrypt.hash(password, 10)

// ะัะพะฒะตัะบะฐ ะฟัะธ ะฒัะพะดะต:
const isValid = await bcrypt.compare(password, hashedPassword)
```

**ะะพัะตะผั ะฑะตะทะพะฟะฐัะฝะพ**:
- โ ะกะพะปั ะณะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- โ ะะฐัะธัะฐ ะพั rainbow tables
- โ ะะตะดะปะตะฝะฝัะน ะฐะปะณะพัะธัะผ (ะทะฐัะธัะฐ ะพั ะฑััััะพััะฐ)
- โ ะะตะฒะพะทะผะพะถะฝะพ ัะฐััะธััะพะฒะฐัั ัะตั ะพะฑัะฐัะฝะพ

### 2. **JWT** - JSON Web Tokens

```typescript
// ะะตะฝะตัะฐัะธั ัะพะบะตะฝะฐ:
const payload = { sub: user._id, email: user.email }
const token = this.jwtService.sign(payload)

// ะขะพะบะตะฝ ัะพะดะตัะถะธั:
// - Header: ะฐะปะณะพัะธัะผ (HS256)
// - Payload: ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั (sub, email)
// - Signature: ะฟะพะดะฟะธัั (ะฟัะพะฒะตัะบะฐ ัะตะปะพััะฝะพััะธ)
```

**ะะพัะตะผั ะฑะตะทะพะฟะฐัะฝะพ**:
- โ ะะพะดะฟะธัั ะฟัะพะฒะตััะตััั ัะตะบัะตัะฝัะผ ะบะปััะพะผ
- โ ะะตะฒะพะทะผะพะถะฝะพ ะฟะพะดะดะตะปะฐัั ัะพะบะตะฝ ะฑะตะท ะบะปััะฐ
- โ ะกัะพะบ ะดะตะนััะฒะธั (7 ะดะฝะตะน)
- โ Stateless (ะฝะต ะฝัะถะฝะฐ ัะตััะธั ะฝะฐ ัะตัะฒะตัะต)

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั

### ะะตะณะธัััะฐัะธั (POST /auth/register):

```
1. Frontend โ POST /auth/register { name, email, password }
2. AuthController โ ะะพะปััะฐะตั ะทะฐะฟัะพั, ะฒะฐะปะธะดะธััะตั ัะตัะตะท RegisterDto
3. AuthService.register() โ ะัะพะฒะตััะตั email, ัะตัะธััะตั ะฟะฐัะพะปั, ัะพะทะดะฐัั User
4. MongoDB โ ะกะพััะฐะฝัะตั User ั ัะตัะตะผ ะฟะฐัะพะปั
5. JwtService โ ะะตะฝะตัะธััะตั ัะพะบะตะฝ
6. Frontend โ ะะพะทะฒัะฐัะฐะตั { access_token, user }
```

### ะัะพะด (POST /auth/login):

```
1. Frontend โ POST /auth/login { email, password }
2. AuthController โ ะะพะปััะฐะตั ะทะฐะฟัะพั, ะฒะฐะปะธะดะธััะตั ัะตัะตะท LoginDto
3. AuthService.login() โ ะัะตั User, ะฟัะพะฒะตััะตั ะฟะฐัะพะปั ัะตัะตะท bcrypt
4. JwtService โ ะะตะฝะตัะธััะตั ัะพะบะตะฝ
5. Frontend โ ะะพะทะฒัะฐัะฐะตั { access_token, user }
```

### ะะฐัะธััะฝะฝัะน ะทะฐะฟัะพั (GET /auth/profile):

```
1. Frontend โ GET /auth/profile
   Headers: Authorization: Bearer <token>
2. JwtAuthGuard โ ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ัะพะบะตะฝะฐ
3. JwtStrategy โ ะัะพะฒะตััะตั ะฟะพะดะฟะธัั, ััะพะบ ะดะตะนััะฒะธั, ะฒะฐะปะธะดะธััะตั User
4. AuthController โ req.user ัะพะดะตัะถะธั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
5. Frontend โ ะะพะทะฒัะฐัะฐะตั user
```

---

## ๐ ะงัะพ ะธะทััะธัั ะดะฐะปััะต

### ะะปั Frontend ัะฐะทัะฐะฑะพััะธะบะฐ:

1. **ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั API** - ัะผ. `02_API_Usage_Guide.md`
2. **JWT ัะพะบะตะฝั** - ัะผ. `05_JWT_Security.md`
3. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ** - ัะผ. `07_Error_Handling.md`

### ะัะปะธ ะธะฝัะตัะตัะฝะพ Backend:

1. **Dependency Injection** - ัะผ. `06_Dependency_Injection.md`
2. **DTO ะฒะฐะปะธะดะฐัะธั** - ัะผ. `03_DTO_Pattern.md`
3. **ะััะธัะตะบัััะฝัะต ะฟะฐััะตัะฝั** - ัะผ. `04_Design_Patterns.md`

---

## ๐ ะะตะทัะผะต

**ะงัะพ ะฟะพะปััะธะปะพัั**:
- โ ะะฐัััะฐะฑะธััะตะผะฐั ะฐััะธัะตะบัััะฐ (ะปะตะณะบะพ ัะฐััะธัััั)
- โ ะะตะทะพะฟะฐัะฝะพััั (bcrypt + JWT)
- โ ะขะธะฟะพะฑะตะทะพะฟะฐัะฝะพััั (TypeScript + DTO)
- โ Best practices (DI, Layered Architecture, Patterns)
- โ ะะพัะพะฒัะน API ะดะปั Frontend

**ะกะปะตะดัััะธะน ัะฐะณ**:
ะะทััะธัะต `02_API_Usage_Guide.md` - ะบะฐะบ ัะฐะฑะพัะฐัั ั API ะธะท Frontend!
