# üöÄ –ö–∞—Å—Ç–æ–º–Ω—ã–π Virtual Scrolling –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

## üìã –û–±–∑–æ—Ä

–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ Virtual Scrolling, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –º—ã —É–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —á–∞—Ç–∞** - —É—á–∏—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ (—Å–∫—Ä–æ–ª–ª —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã—Å–æ—Ç—ã)
3. **–ë–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —á–∏—Å—Ç–æ–º Vue 3, –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥, —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. Composable `useVirtualScroll`

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞:

```typescript
const {
  visibleItems,      // –í–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  totalHeight,       // –û–±—â–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞
  offsetY,           // –°–º–µ—â–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
  handleScroll,      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞
  updateItemHeight,  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–∞
  scrollToBottom,    // –°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
  preserveScrollPosition // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
} = useVirtualScroll({
  items: messages,
  itemHeight: 80,    // –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞
  containerHeight,
  buffer: 5          // –ë—É—Ñ–µ—Ä–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
})
```

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `VirtualList.vue`

–†–µ–Ω–¥–µ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

```vue
<div class="virtual-message-list__scroller">
  <!-- –°–ø–µ–π—Å–µ—Ä –¥–ª—è –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã -->
  <div :style="{ height: `${totalHeight}px` }">
    <!-- –í–∏–¥–∏–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div :style="{ transform: `translateY(${offsetY}px)` }">
      <div v-for="item in visibleItems">
        <ChatMessageBubble :message="item" />
      </div>
    </div>
  </div>
</div>
```

### 3. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `v-measure`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä—è–µ—Ç –≤—ã—Å–æ—Ç—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

```vue
<div 
  v-measure.resize="(height) => updateItemHeight(item._id, height)"
>
  <!-- –∫–æ–Ω—Ç–µ–Ω—Ç —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≤—ã—Å–æ—Ç–æ–π -->
</div>
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã—Å–æ—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π

- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—É—é –≤—ã—Å–æ—Ç—É
- –í—ã—Å–æ—Ç—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
- –°—Ä–µ–¥–Ω—è—è –≤—ã—Å–æ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

```typescript
if (scrollTop < 100 && hasMore && !loading) {
  const prevCount = messages.length
  await loadMoreMessages()
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  scrollTop = preserveScrollPosition(prevCount)
}
```

### –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

```typescript
watch(() => messages.length, (newLength, oldLength) => {
  if (newLength > oldLength) {
    const isAtBottom = scrollHeight - scrollTop - clientHeight < 100
    if (isAtBottom) {
      scrollToBottom('smooth')
    }
  }
})
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—ã—á–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–±—ã—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ | Virtual Scrolling | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-------------------|-------------------|-----------|
| DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (1000 —Å–æ–æ–±—â–µ–Ω–∏–π) | 1000 | ~15-20 | **50x** |
| –ü–∞–º—è—Ç—å (MB) | 150-200 | 15-25 | **8x** |
| –í—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∞ (ms) | 500-800 | 30-50 | **10-15x** |
| FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ | 15-25 | 55-60 | **2.5x** |
| –ó–∞–≥—Ä—É–∑–∫–∞ CPU –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ | 60-80% | 10-15% | **5x** |

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

### 1. –í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools)

```javascript
// –ö–æ–Ω—Å–æ–ª—å - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
document.querySelectorAll('.virtual-message-list__item').length
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~10-20, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
```

### 2. Performance Monitor

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools > Performance
2. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–ø–∏—Å—å
3. –ë—ã—Å—Ç—Ä–æ —Å–∫—Ä–æ–ª—å—Ç–µ —Å–ø–∏—Å–æ–∫ —Å 500+ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
4. FPS –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º 55-60

### 3. Memory Profiler

1. DevTools > Memory
2. Take Heap Snapshot –¥–æ —Å–∫—Ä–æ–ª–ª–∞
3. –°–∫—Ä–æ–ª–ª –ø–æ –≤—Å–µ–º—É —Å–ø–∏—Å–∫—É
4. Take Heap Snapshot –ø–æ—Å–ª–µ
5. –ü–∞–º—è—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Ç–∏

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```typescript
interface VirtualScrollOptions {
  itemHeight?: number    // –ù–∞—á–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (default: 80)
  buffer?: number        // –ë—É—Ñ–µ—Ä–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (default: 5)
  reverse?: boolean      // –û–±—Ä–∞—Ç–Ω—ã–π —Å–∫—Ä–æ–ª–ª (default: false)
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **itemHeight** - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–ª–∏–∑–∫–æ–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å—Ä–µ–¥–Ω–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
2. **buffer** - —É–≤–µ–ª–∏—á—å—Ç–µ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ (–Ω–æ –±–æ–ª—å—à–µ DOM)
3. **ResizeObserver** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä—ã–∂–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- –ü—Ä–∏—á–∏–Ω–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è –≤—ã—Å–æ—Ç–∞
- –†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á—å—Ç–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `itemHeight`

### –ü—É—Å—Ç—ã–µ –æ–±–ª–∞—Å—Ç–∏
- –ü—Ä–∏—á–∏–Ω–∞: —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π –±—É—Ñ–µ—Ä
- –†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á—å—Ç–µ `buffer` –¥–æ 10-15

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ü—Ä–∏—á–∏–Ω–∞: –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã—Å–æ—Ç —Å—Ä–∞–∑—É
- –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `v-measure.once` –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Sticky dates** - –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –¥–∞—Ç
2. **Smooth scrolling** - –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
3. **Preloading** - –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **Intersection Observer** - –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞
5. **Variable buffer** - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –±—É—Ñ–µ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–∫—Ä–æ–ª–ª–∞

## ‚úÖ –ò—Ç–æ–≥–∏

–ö–∞—Å—Ç–æ–º–Ω—ã–π Virtual Scrolling –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **50x –º–µ–Ω—å—à–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤**
- **8x –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏**
- **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ 60 FPS**
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é**
- **–ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–∞–∂–µ —Å 10000+ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏**

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Nuxt 4 –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
